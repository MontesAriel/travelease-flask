{% extends "admin/admin_base.html" %}
{% block title %}
    {% if reserva %}Editar Reserva{% else %}Nueva Reserva{% endif %}
{% endblock %}

{% block content %}
<div class="container mt-4">

    <h2>
        {% if reserva %}Editar Reserva{% else %}Nueva Reserva{% endif %}
    </h2>

    <form 
        action="{% if reserva %}{{ url_for('admin_reserva_update', reserva_id=reserva.reserva_id) }}
                 {% else %}{{ url_for('admin_reserva_create') }}{% endif %}"
        method="POST"
        class="mt-4"
    >

        <!-- Usuario -->
        <div class="mb-3">
            <label class="form-label">Usuario</label>
            <select name="usuario_id" class="form-control" required>
                <option value="">Seleccione un usuario</option>
                {% for u in usuarios %}
                <option value="{{ u.usuario_id }}"
                    {% if reserva and reserva.usuario_id == u.usuario_id %}selected{% endif %}>
                    {{ u.nombre }} {{ u.apellido }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Alojamiento -->
        <div class="mb-3">
            <label class="form-label">Alojamiento</label>
            <select name="alojamiento_id" class="form-control">
                <option value="">Sin alojamiento</option>
                {% for a in alojamientos %}
                <option value="{{ a.alojamiento_id }}"
                    {% if reserva and reserva.alojamiento_id == a.alojamiento_id %}selected{% endif %}>
                    {{ a.nombre }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Vuelo Ida -->
        <div class="mb-3">
            <label class="form-label">Vuelo Ida</label>
            <select name="vuelo_ida_id" class="form-control">
                <option value="">Sin vuelo</option>
                {% for v in vuelos %}
                <option value="{{ v.vuelo_id }}"
                    {% if reserva and reserva.vuelo_ida_id == v.vuelo_id %}selected{% endif %}>
                    {{ v.codigo }} - {{ v.origen.codigo }} → {{ v.destino.codigo }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Vuelo Vuelta -->
        <div class="mb-3">
            <label class="form-label">Vuelo Vuelta</label>
            <select name="vuelo_vuelta_id" class="form-control">
                <option value="">Sin vuelo</option>
                {% for v in vuelos %}
                <option value="{{ v.vuelo_id }}"
                    {% if reserva and reserva.vuelo_vuelta_id == v.vuelo_id %}selected{% endif %}>
                    {{ v.codigo }} - {{ v.origen.codigo }} → {{ v.destino.codigo }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Fechas -->
        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha Inicio</label>
                <input type="date" name="fecha_inicio" class="form-control"
                       value="{{ reserva.fecha_inicio if reserva else '' }}" required>
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Fecha Fin</label>
                <input type="date" name="fecha_fin" class="form-control"
                       value="{{ reserva.fecha_fin if reserva else '' }}" required>
            </div>
        </div>

        <!-- Pasajeros -->
        <div class="mb-3">
            <label class="form-label">Cantidad de Pasajeros</label>
            <input type="number" name="pasajeros" class="form-control"
                   value="{{ reserva.pasajeros if reserva else 1 }}" required>
        </div>

        <!-- Precio Total -->
        <div class="mb-3">
            <label class="form-label">Precio Total</label>
            <input type="number" step="0.01" name="precio_total" class="form-control"
                   value="{{ reserva.precio_total if reserva else 0 }}" required>
        </div>

        <!-- Estado -->
        <div class="mb-3">
            <label class="form-label">Estado</label>
            <select name="estado" class="form-control" required>
                <option value="pendiente"
                    {% if reserva and reserva.estado == "pendiente" %}selected{% endif %}>Pendiente</option>
                <option value="confirmada"
                    {% if reserva and reserva.estado == "confirmada" %}selected{% endif %}>Confirmada</option>
                <option value="cancelada"
                    {% if reserva and reserva.estado == "cancelada" %}selected{% endif %}>Cancelada</option>
            </select>
        </div>

        <!-- Botón -->
        <button class="btn btn-success">
            {% if reserva %}Guardar Cambios{% else %}Crear Reserva{% endif %}
        </button>

    </form>
</div>
{% endblock %}
