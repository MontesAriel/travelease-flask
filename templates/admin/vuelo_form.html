{% extends "admin/admin_base.html" %}
{% block title %}{{ 'Editar Vuelo' if vuelo else 'Nuevo Vuelo' }}{% endblock %}

{% block content %}

<h2 class="mb-4">{{ 'Editar Vuelo' if vuelo else 'Nuevo Vuelo' }}</h2>

<div class="shadow-sm bg-white p-4 rounded">

    <form action="{{ url_for('admin_vuelos_update', vuelo_id=vuelo.vuelo_id) if vuelo else url_for('admin_vuelo_create') }}"
          method="POST">

        <div class="mb-3">
            <label class="form-label">Aerolínea</label>
            <select name="aerolinea_id" class="form-select" required>
                <option value="">-- seleccionar --</option>
                {% for a in aerolineas %}
                <option value="{{ a.aerolinea_id }}"
                    {% if vuelo and vuelo.aerolinea_id == a.aerolinea_id %}selected{% endif %}>
                    {{ a.nombre }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="row mb-3">
            <div class="col">
                <label class="form-label">Origen</label>
                <select name="origen_id" class="form-select" required>
                    <option value="">-- seleccionar --</option>
                    {% for ap in aeropuertos %}
                    <option value="{{ ap.aeropuerto_id }}"
                        {% if vuelo and vuelo.origen_id == ap.aeropuerto_id %}selected{% endif %}>
                        {{ ap.nombre }} ({{ ap.ciudad }})
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col">
                <label class="form-label">Destino</label>
                <select name="destino_id" class="form-select" required>
                    <option value="">-- seleccionar --</option>
                    {% for ap in aeropuertos %}
                    <option value="{{ ap.aeropuerto_id }}"
                        {% if vuelo and vuelo.destino_id == ap.aeropuerto_id %}selected{% endif %}>
                        {{ ap.nombre }} ({{ ap.ciudad }})
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="col mt-3">
            <label class="form-label">Tipo de vuelo</label>
            <select name="tipo_vuelo" id="tipo_vuelo" class="form-select" required>
                <option value="">-- seleccionar tipo --</option>

                <option value="ida"
                    {% if paquete and paquete.tipo == "ida" %}selected{% endif %}>
                    Ida
                </option>

                <option value="vuelta"
                    {% if not paquete or paquete.tipo == "vuelta" %}selected{% endif %}>
                    Vuelta
                </option>
            </select>
        </div>

        <div class="col mt-3" id="destino_turistico_box">
            <label class="form-label">Destino Turístico</label>
            <select name="destino_turistico_id" class="form-select">
                <option value="">-- seleccionar destino --</option>
                {% for d in destinos %}
                <option value="{{ d.destino_id }}"
                        {% if paquete and paquete.destino_id == d.destino_id %}selected{% endif %}>
                    {{ d.nombre }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="row mb-3">
            <div class="col">
                <label class="form-label">Fecha de salida</label>
                <input type="datetime-local" name="fecha_salida" class="form-control"
                       required
                       value="{{ vuelo.fecha_salida.isoformat(timespec='minutes') if vuelo else '' }}">
            </div>

            <div class="col">
                <label class="form-label">Fecha de llegada</label>
                <input type="datetime-local" name="fecha_llegada" class="form-control"
                       required
                       value="{{ vuelo.fecha_llegada.isoformat(timespec='minutes') if vuelo else '' }}">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Precio</label>
            <input type="number" step="0.01" name="precio" class="form-control"
                   required
                   value="{{ vuelo.precio if vuelo else '' }}">
        </div>

        <button class="btn btn-primary" type="submit">
            {{ 'Actualizar' if vuelo else 'Crear' }}
        </button>

        <a href="{{ url_for('admin_vuelos') }}" class="btn btn-secondary">
            Cancelar
        </a>

    </form>

</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const tipoSelect = document.getElementById("tipo_vuelo");
    const destinoBox = document.getElementById("destino_turistico_box");

    function actualizar() {
        if (tipoSelect.value === "ida") {
            destinoBox.style.display = "block";
        } else {
            destinoBox.style.display = "none";
        }
    }

    tipoSelect.addEventListener("change", actualizar);
    actualizar();
});
</script>
{% endblock %}
